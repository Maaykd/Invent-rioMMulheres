<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de Invent√°rio Patrimonial - Minist√©rio das Mulheres">
    <meta name="theme-color" content="#7B1E6A">
    <title>Sistema de Invent√°rio Patrimonial</title>
    
    <!-- Biblioteca QuaggaJS para leitura de c√≥digo de barras -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    
    <!-- Estilos -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header institucional -->
    <header class="header">
        <h1>üìã Sistema de Invent√°rio Patrimonial - MMulheres</h1>
        <small>Minist√©rio das Mulheres ‚Ä¢ Controle de Patrim√¥nio - Feito por Maycon Douglas</small>
    </header>

    <main class="container">
        <!-- Cards de Estat√≠sticas -->
        <section class="stats">
            <div class="stat-card">
                <div class="label">Total de Itens</div>
                <div class="value" id="stat-total">0</div>
            </div>
            <div class="stat-card localizados">
                <div class="label">Localizados</div>
                <div class="value" id="stat-localizados">0</div>
            </div>
            <div class="stat-card pendentes">
                <div class="label">Pendentes</div>
                <div class="value" id="stat-pendentes">0</div>
            </div>
            <div class="stat-card bipados">
                <div class="label">Bipados</div>
                <div class="value" id="stat-bipados">0</div>
            </div>
        </section>

        <!-- Barra de Progresso -->
        <section class="progress-container">
            <div class="progress-header">
                <h3>Progresso do Invent√°rio</h3>
                <span class="percent" id="stat-percentual">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
            </div>
            <div class="progress-text">
                <span><span id="stat-localizados-text">0</span> localizados</span>
                <span><span id="stat-pendentes-text">0</span> pendentes de <span id="stat-total-text">0</span></span>
            </div>
            <div class="progress-legend">
                <span><span class="legend-dot localizado"></span> Localizados</span>
                <span><span class="legend-dot pendente"></span> Pendentes</span>
                <span><span class="legend-dot bipado"></span> Bipados</span>
            </div>
        </section>

        <!-- Navega√ß√£o por Abas -->
        <nav class="tabs">
            <button class="tab active" data-tab="scanner">üì∑ Scanner</button>
            <button class="tab" data-tab="importar">üìÅ Importar</button>
            <button class="tab" data-tab="localizados">
                ‚úÖ Localizados
                <span class="badge-count" id="tab-localizados-count">0</span>
            </button>
            <button class="tab" data-tab="pendentes">
                ‚è≥ Pendentes
                <span class="badge-count" id="tab-pendentes-count">0</span>
            </button>
            <button class="tab" data-tab="bipados">
                üìã Bipados
                <span class="badge-count" id="tab-bipados-count">0</span>
            </button>
            <button class="tab" data-tab="por-coordenacao">üè¢ Por Coordena√ß√£o</button>
            <button class="tab" data-tab="config">‚öôÔ∏è Configura√ß√µes</button>
        </nav>

        <!-- ==================== PAINEL: SCANNER ==================== -->
        <article class="panel active" id="panel-scanner">
            <h2>üì∑ Leitura de Patrim√¥nio</h2>
            
            <div class="scanner-area">
                <!-- Sele√ß√£o de modo -->
                <div class="scanner-modes">
                    <button class="mode-btn active" id="mode-manual" onclick="setMode('manual')">
                        ‚å®Ô∏è Digitar/Leitor USB
                    </button>
                    <button class="mode-btn" id="mode-camera" onclick="setMode('camera')">
                        üì± C√¢mera do Celular
                    </button>
                </div>

                <!-- Entrada Manual -->
                <section class="input-section" id="section-manual">
                    <div class="input-group">
                        <label for="input-patrimonio">N√∫mero do Patrim√¥nio:</label>
                        <div class="input-wrapper">
                            <input type="text" 
                                   id="input-patrimonio" 
                                   placeholder="Ex: 6644720" 
                                   autocomplete="off"
                                   autofocus>
                        </div>
                    </div>
                    <button class="btn btn-success btn-lg btn-block" onclick="verificarPatrimonio()">
                        ‚úì Verificar Patrim√¥nio
                    </button>
                    <p class="shortcut-hint">üí° Pressione <kbd>Enter</kbd> para verificar</p>
                </section>

                <!-- C√¢mera -->
                <section class="camera-section" id="section-camera">
                    <div class="camera-container">
                        <div id="camera-preview"></div>
                        <div class="camera-overlay size-medium" id="camera-overlay"></div>
                    </div>
                    <div class="camera-status" id="camera-status">
                        Clique em "Iniciar C√¢mera" para come√ßar
                    </div>
                    <div class="camera-controls">
                        <button class="btn btn-success" id="btn-start-camera" onclick="iniciarCamera()">
                            ‚ñ∂Ô∏è Iniciar C√¢mera
                        </button>
                        <button class="btn btn-danger" id="btn-stop-camera" onclick="pararCamera()" style="display: none;">
                            ‚èπÔ∏è Parar
                        </button>
                        <button class="btn btn-flash" id="btn-flash" onclick="toggleFlash()" style="display: none;">
                            üî¶ Lanterna
                        </button>
                    </div>
                    <div class="camera-advanced-controls" id="camera-advanced" style="display: none;">
                        <div class="control-row">
                            <label>üîç Zoom:</label>
                            <input type="range" id="zoom-slider" min="1" max="5" step="0.1" value="1" 
                                   oninput="ajustarZoom(this.value)">
                            <span class="value-display" id="zoom-value">1.0x</span>
                        </div>
                        <div class="control-row">
                            <label>üìê √Årea de leitura:</label>
                            <div class="size-buttons">
                                <button class="size-btn" onclick="setOverlaySize('small')">Pequena</button>
                                <button class="size-btn active" onclick="setOverlaySize('medium')">M√©dia</button>
                                <button class="size-btn" onclick="setOverlaySize('large')">Grande</button>
                            </div>
                        </div>
                    </div>
                    <div class="info-box">
                        <strong>üì± Dicas para melhor leitura:</strong><br>
                        ‚Ä¢ Mantenha o c√≥digo de barras dentro da √°rea marcada<br>
                        ‚Ä¢ Use boa ilumina√ß√£o ou ative a lanterna<br>
                        ‚Ä¢ Ajuste o zoom para c√≥digos pequenos<br>
                        ‚Ä¢ Mantenha o celular est√°vel
                    </div>
                </section>

                <!-- Resultado do Scan -->
                <div class="scan-result" id="scan-result">
                    <div class="icon" id="result-icon"></div>
                    <div class="status" id="result-status"></div>
                    <div class="details" id="result-details"></div>
                </div>

                <!-- Hist√≥rico de Leituras -->
                <aside class="historico">
                    <h3>üïê √öltimas Leituras</h3>
                    <div id="historico-lista">
                        <div class="empty-state">
                            <div class="icon">üì≠</div>
                            <p>Nenhuma leitura ainda</p>
                        </div>
                    </div>
                </aside>
            </div>
        </article>

        <!-- ==================== PAINEL: IMPORTAR ==================== -->
        <article class="panel" id="panel-importar">
            <h2>üìÅ Importar Invent√°rio</h2>
            
            <div class="info-box">
                <strong>Formato esperado:</strong> Arquivo CSV com colunas: patrim√¥nio, descri√ß√£o, categoria, valor, 
                <u>uorg_destino</u>, coordenacao_destino, localidade.<br><br>
                <strong>L√≥gica de verifica√ß√£o:</strong><br>
                ‚Ä¢ Itens com <strong>UORG Destino preenchido</strong> = J√° localizado ‚úÖ<br>
                ‚Ä¢ Itens com <strong>UORG Destino vazio</strong> = Pendente de localiza√ß√£o ‚è≥
            </div>

            <div class="upload-area" id="upload-area">
                <input type="file" id="arquivo-csv" accept=".csv,.txt">
                <div class="upload-icon">üìÑ</div>
                <h3>Clique ou arraste um arquivo CSV</h3>
                <p>Separador: ponto-e-v√≠rgula (;) ou v√≠rgula (,)</p>
            </div>
            
            <div id="import-status"></div>
        </article>

        <!-- ==================== PAINEL: LOCALIZADOS ==================== -->
        <article class="panel" id="panel-localizados">
            <h2>‚úÖ Itens Localizados (com UORG Destino)</h2>
            
            <div class="actions">
                <button class="btn btn-success" onclick="exportarCSV('localizados')">
                    üì• Exportar CSV
                </button>
            </div>
            
            <div class="search-box">
                <input type="text" 
                       id="busca-localizados" 
                       placeholder="üîç Buscar por patrim√¥nio ou descri√ß√£o...">
            </div>
            
            <div class="table-container" style="max-height: 500px; overflow-y: auto;" data-tabela="localizados">
                <table>
                    <thead>
                        <tr>
                            <th data-coluna="patrimonio" onclick="App.ordenarTabela('localizados', 'patrimonio')">
                                Patrim√¥nio <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="descricao" onclick="App.ordenarTabela('localizados', 'descricao')">
                                Descri√ß√£o <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="uorg_destino" onclick="App.ordenarTabela('localizados', 'uorg_destino')">
                                UORG Destino <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="coordenacao_destino" onclick="App.ordenarTabela('localizados', 'coordenacao_destino')">
                                Coord. Destino <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="localidade" onclick="App.ordenarTabela('localizados', 'localidade')">
                                Localidade <span class="sort-icon">‚Üï</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tabela-localizados"></tbody>
                </table>
            </div>
        </article>

        <!-- ==================== PAINEL: PENDENTES ==================== -->
        <article class="panel" id="panel-pendentes">
            <h2>‚è≥ Itens Pendentes (sem UORG Destino)</h2>
            
            <div class="actions">
                <button class="btn btn-success" onclick="exportarCSV('pendentes')">
                    üì• Exportar CSV
                </button>
            </div>
            
            <div class="search-box">
                <input type="text" 
                       id="busca-pendentes" 
                       placeholder="üîç Buscar por patrim√¥nio ou descri√ß√£o...">
            </div>
            
            <div class="table-container" style="max-height: 500px; overflow-y: auto;" data-tabela="pendentes">
                <table>
                    <thead>
                        <tr>
                            <th data-coluna="patrimonio" onclick="App.ordenarTabela('pendentes', 'patrimonio')">
                                Patrim√¥nio <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="descricao" onclick="App.ordenarTabela('pendentes', 'descricao')">
                                Descri√ß√£o <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="categoria" onclick="App.ordenarTabela('pendentes', 'categoria')">
                                Categoria <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="coordenacao_destino" onclick="App.ordenarTabela('pendentes', 'coordenacao_destino')">
                                Coord. Destino <span class="sort-icon">‚Üï</span>
                            </th>
                            <th>Status Bipagem</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-pendentes"></tbody>
                </table>
            </div>
        </article>

        <!-- ==================== PAINEL: BIPADOS ==================== -->
        <article class="panel" id="panel-bipados">
            <h2>üìã Itens Bipados (verificados pelo scanner)</h2>
            
            <div class="actions">
                <button class="btn btn-success" onclick="exportarCSV('bipados')">
                    üì• Exportar CSV
                </button>
            </div>
            
            <div class="search-box">
                <input type="text" 
                       id="busca-bipados" 
                       placeholder="üîç Buscar por patrim√¥nio ou descri√ß√£o...">
            </div>
            
            <div class="table-container" style="max-height: 500px; overflow-y: auto;" data-tabela="bipados">
                <table>
                    <thead>
                        <tr>
                            <th data-coluna="patrimonio" onclick="App.ordenarTabela('bipados', 'patrimonio')">
                                Patrim√¥nio <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="descricao" onclick="App.ordenarTabela('bipados', 'descricao')">
                                Descri√ß√£o <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="uorg_destino" onclick="App.ordenarTabela('bipados', 'uorg_destino')">
                                UORG Destino <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="coordenacao_destino" onclick="App.ordenarTabela('bipados', 'coordenacao_destino')">
                                Coord. Destino <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="data_bipagem" onclick="App.ordenarTabela('bipados', 'data_bipagem')">
                                Data/Hora Bipagem <span class="sort-icon">‚Üï</span>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="tabela-bipados"></tbody>
                </table>
            </div>
        </article>

        <!-- ==================== PAINEL: POR COORDENA√á√ÉO ==================== -->
        <article class="panel" id="panel-por-coordenacao">
            <h2>üè¢ Itens por Coordena√ß√£o Destino</h2>

            <div class="config-section">
                <h3>Selecione a coordena√ß√£o destino</h3>
                <select id="select-coordenacao">
                    <option value="">-- Escolha uma coordena√ß√£o destino --</option>
                </select>
            </div>

            <div class="actions">
                <button class="btn btn-success" onclick="exportarPorCoordenacao()">
                    üì• Exportar CSV desta coordena√ß√£o
                </button>
            </div>

            <div class="table-container" style="max-height: 500px; overflow-y: auto;" data-tabela="coordenacao">
                <table>
                    <thead>
                        <tr>
                            <th data-coluna="patrimonio" onclick="App.ordenarTabela('coordenacao', 'patrimonio')">
                                Patrim√¥nio <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="descricao" onclick="App.ordenarTabela('coordenacao', 'descricao')">
                                Descri√ß√£o <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="categoria" onclick="App.ordenarTabela('coordenacao', 'categoria')">
                                Categoria <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="uorg_destino" onclick="App.ordenarTabela('coordenacao', 'uorg_destino')">
                                UORG Destino <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="localidade" onclick="App.ordenarTabela('coordenacao', 'localidade')">
                                Localidade <span class="sort-icon">‚Üï</span>
                            </th>
                            <th data-coluna="coordenacao_destino">Coordena√ß√£o</th>
                            <th>Status</th>
                            <th>Data Leitura</th>
                        </tr>
                    </thead>
                    <tbody id="tabela-por-coordenacao"></tbody>
                </table>
            </div>
        </article>

        <!-- ==================== PAINEL: CONFIGURA√á√ïES ==================== -->
        <article class="panel" id="panel-config">
            <h2>‚öôÔ∏è Configura√ß√µes</h2>
            
            <!-- Exportar Relat√≥rios -->
            <section class="config-section">
                <h3>üì• Exportar Relat√≥rios</h3>
                <p>Baixe os dados do invent√°rio em formato CSV.</p>
                <div class="actions">
                    <button class="btn btn-success" onclick="exportarCSV('completo')">
                        üìä Invent√°rio Completo
                    </button>
                    <button class="btn btn-primary" onclick="exportarCSV('localizados')">
                        ‚úÖ Localizados
                    </button>
                    <button class="btn btn-secondary" onclick="exportarCSV('pendentes')">
                        ‚è≥ Pendentes
                    </button>
                    <button class="btn btn-action" onclick="exportarCSV('bipados')">
                        üìã Bipados
                    </button>
                </div>
            </section>

            <!-- Backup e Restaura√ß√£o -->
            <section class="config-section">
                <h3>üíæ Backup e Restaura√ß√£o</h3>
                <p>Salve ou restaure todos os dados do sistema (invent√°rio, bipagens e hist√≥rico).</p>
                <div class="actions">
                    <button class="btn btn-primary" onclick="exportarBackup()">
                        üì§ Exportar Backup (JSON)
                    </button>
                    <button class="btn btn-outline" onclick="importarBackup()">
                        üì• Importar Backup
                    </button>
                    <input type="file" id="input-restore-backup" accept=".json" style="display: none;">
                </div>
            </section>

            <!-- Limpar Bipagens -->
            <section class="config-section">
                <h3>üîÑ Limpar Bipagens</h3>
                <p>Remove o registro de bipagens (verifica√ß√µes do scanner), mas mant√©m o invent√°rio.</p>
                <button class="btn btn-danger" onclick="limparBipagens()">
                    üóëÔ∏è Limpar Bipagens
                </button>
            </section>

            <!-- Resetar Sistema -->
            <section class="config-section">
                <h3>‚ö†Ô∏è Resetar Sistema</h3>
                <p>Remove TODOS os dados (invent√°rio + bipagens). A√ß√£o irrevers√≠vel!</p>
                <button class="btn btn-danger" onclick="limparTudo()">
                    üí£ Resetar Tudo
                </button>
            </section>
        </article>
    </main>

    <!-- Toast para notifica√ß√µes -->
    <div class="toast" id="toast"></div>

    <!-- Scripts modulares -->
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/data.js"></script>
    <script src="js/csv.js"></script>
    <script src="js/camera.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>
</html>